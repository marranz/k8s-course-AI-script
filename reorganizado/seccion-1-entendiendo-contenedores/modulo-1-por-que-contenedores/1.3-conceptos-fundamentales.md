# 1.2 Conceptos Fundamentales de los Contenedores

## Conceptos Clave

1. **Imágenes:** Plantillas inmutables de solo lectura
2. **Contenedores:** Instancias ejecutables de imágenes
3. **Capas (Layers):** Cómo se construyen las imágenes de forma eficiente
4. **Filesystem CoW (Copy-on-Write):** Optimización de espacio y rendimiento

## Contenedores e Imágenes

Como hemos dicho antes, diremos que un **contenedor** es un paquete ligero y portable que podremos usar para ejecutar nuestras aplicaciones. Tiene lo mínimo necesario para que nuestra aplicación pueda correr, es decir:
- El código
- El runtime de nuestra aplicación
- Las herramientas y librerías del sistema que este mismo utilizará
- La configuración de la aplicación

El contenido de un contenedor viene dado por su **imagen**. La imagen define qué habrá en el disco donde ese contenedor está ejecutándose. Ahí entra todo lo mencionado antes: el runtime, herramientas del sistema, librerías y la configuración.

### Ejemplo: Aplicación PyCont

Imaginemos que queremos un contenedor para nuestra aplicación de contabilidad desarrollada en Python. Nuestra aplicación se llamará **PyCont**.

1. Usaremos una imagen base que podremos obtener online con Python ya preinstalado y todas sus herramientas comunes. Imaginemos que esta imagen se llama `python-base:3.6`

2. Sobre esta imagen base y tras agregarle nuestro código y configuración para nuestra aplicación, obtendremos la imagen de nuestro contenedor, a la que ahora sí, llamamos `PyCont:1.0`

El resultado final será una **imagen dedicada para nuestra aplicación**.

Podremos ahora lanzar tantas copias de nuestra aplicación como queramos simplemente creando contenedores basados en esta imagen. El contenedor simplemente estará ejecutando un proceso de Python por cada contenedor que lancemos. El proceso correrá en el contexto de nuestra imagen, es decir, que tendrá acceso al código y la configuración.

## Capas (Layers) y Filesystem CoW (Copy-on-Write)

### Capas de Imagen

Las imágenes de contenedores están compuestas por un conjunto de **capas de solo lectura apiladas**. Cada instrucción que le demos al software que se encarga de crear nuestra imagen a través del fichero de definición de imagen (`Dockerfile`), creará una nueva capa sobre la anterior.

**Ventajas del diseño en capas:**

1. **Eficiencia:** Solo se modificará una capa cuando la orden haya sido modificada o cuando una capa anterior haya cambiado

2. **Reutilización:** Múltiples imágenes podrían compartir capas, ahorrando:
   - Espacio en disco
   - Tiempo de descarga de imágenes

### Filesystem Copy-on-Write (CoW)

Cuando lanzamos un contenedor a partir de una imagen, el engine de contenedores:

1. Obtiene la imagen (solo lectura)
2. Agrega una **capa de escritura** donde el contenedor hará todas las operaciones de escritura:
   - Crear nuevos ficheros
   - Modificar ficheros existentes

De esta forma, un contenedor **nunca modificará el archivo de imagen original**, sino que irá añadiendo capas de disco según lo vaya necesitando.

**Beneficios:**

- **Alta eficiencia** en entornos donde los ficheros de imagen originales van a ser reutilizados
- **Ahorro de espacio en disco**
- **Mejor rendimiento** (no hace falta crear una copia completa de cada imagen por cada contenedor, como sí es habitual en entornos de máquinas virtuales, aunque también se puede usar un sistema parecido)

### ⚠️ Importante: Persistencia de Datos

Cuando el contenedor se elimina, la capa de escritura se pierde, por lo tanto **todos los datos que ese contenedor había escrito en disco también**.

Por eso es importante tener en cuenta **recursos externos de almacenamiento** cuando nuestros contenedores necesitan persistencia de datos.
