# 4.2 Introducción a Containerd

## ¿Qué es Containerd?

Containerd se considera un **runtime de contenedores de alto nivel** y está enfocado en la ejecución de contenedores individuales mediante:
- La línea de comandos
- Órdenes a través de su interfaz API

**Cobertura funcional:**
- Creación de imágenes
- Gestión de volúmenes
- Configuración de red
- Ciclo de vida del contenedor

## Objetivo de Containerd

Proporcionar una API robusta para la gestión del ciclo de vida de los contenedores:
- Gestión de imágenes
- Ejecución de contenedores
- Gestión de almacenamiento
- Compatibilidad con CRI (Container Runtime Interface)

## Formas de Usar Containerd

Podemos utilizar containerd como:

### 1. Daemon instalado en nuestra máquina Linux
Interactuar utilizando la línea de comandos directamente

### 2. Componente de Kubernetes
Dejar que sea un componente de Kubernetes llamado **kubelet** el que haga el trabajo por nosotros

### 3. A través de Docker Engine
Instalar Docker Engine para hacer exactamente lo mismo, puesto que este a día de hoy depende de containerd (no olvidemos que ellos donaron su código inicialmente)

## Relación con Docker

### ¿Cómo Docker Engine usa containerd "por debajo"?

Aunque suene paradójico, también podemos instalar Docker Engine para gestionar contenedores, puesto que este a día de hoy depende de containerd.

**Arquitectura:**
```
┌─────────────────┐
│   Docker CLI    │
└────────┬────────┘
         │
┌────────▼────────┐
│  Docker Engine  │
│   (dockerd)     │
└────────┬────────┘
         │
┌────────▼────────┐
│   containerd    │
└────────┬────────┘
         │
┌────────▼────────┐
│      runC       │
└────────┬────────┘
         │
┌────────▼────────┐
│  Linux Kernel   │
└─────────────────┘
```

## Opciones para Gestionar Contenedores

Si quisiéramos utilizar la línea de comandos para gestionar nuestros contenedores, por tanto, tenemos dos opciones:

### Opción 1: Docker Engine
1. Instalar Docker Engine
2. Usar la línea de comandos de Docker
3. Este gestionará los contenedores de forma transparente a través de containerd
4. No necesitamos conocer cómo funciona containerd, solo Docker Engine

### Opción 2: Containerd Directo
1. Instalar containerd
2. Utilizar el cliente de containerd (`ctr`) para la gestión de contenedores
3. Más ligero, sin las capas adicionales de Docker

## Herramientas CLI para Containerd

### ctr
- Cliente oficial de containerd
- Más orientado a debugging y desarrollo
- Sintaxis más compleja

### nerdctl
- Cliente alternativo compatible con Docker
- Sintaxis similar a Docker CLI
- Más user-friendly
- Soporta Docker Compose

**Ejemplo de comparación:**
```bash
# Docker
docker run -d -p 8080:80 nginx

# ctr (containerd nativo)
ctr images pull docker.io/library/nginx:latest
ctr run -d docker.io/library/nginx:latest my-nginx

# nerdctl (sintaxis Docker-compatible)
nerdctl run -d -p 8080:80 nginx
```

## Ventajas de Containerd

### 1. Más Ligero
- Menos capas de abstracción
- Menor consumo de recursos

### 2. Más Eficiente
- Mejor rendimiento en entornos de producción
- Especialmente en orquestadores como Kubernetes

### 3. Interfaz Directa con CRI
- Compatible nativamente con Kubernetes
- No necesita capas de traducción

### 4. Mayor Estabilidad
- Diseñado específicamente para entornos de orquestación
- Mejor rendimiento en clusters grandes

## Cuándo Usar Cada Uno

### Usar Docker Engine cuando:
- Estás en desarrollo local
- Necesitas Docker Compose
- Quieres una experiencia user-friendly
- Necesitas compatibilidad con herramientas Docker existentes

### Usar Containerd cuando:
- Estás en producción con Kubernetes
- Necesitas máxima eficiencia
- Quieres el mínimo overhead
- Estás construyendo infraestructura automatizada

## Compatibilidad OCI

Containerd es totalmente compatible con:
- **OCI Image Format Specification** - Para imágenes
- **OCI Runtime Specification** - Para ejecución (usando runC)

Esto significa que las imágenes creadas con Docker funcionan perfectamente con containerd y viceversa.

## Conclusión

Containerd es:
- El motor por defecto de Kubernetes
- Más eficiente que Docker Engine para producción
- Totalmente compatible con estándares OCI
- Una herramienta fundamental en el ecosistema moderno de contenedores

Aunque Docker sigue siendo excelente para desarrollo, containerd es la elección preferida para entornos de producción orquestados.
