# 2.0 Introduccion

En esta seccion vamos a intercalar Partes teoricas con partes practicas para que puedas entender como funciona Docker.

Lo primero que vamos a hacer es instalar docker y comprobar que podemos ejecutar comandos y asi vamos a ir viendo como funciona entendiendo los conceptos teoricos.

Por tanto empezamos con la instalacion de docker en linux

Vamos a usar una maquina virtual ubuntu, en mi caso corriendo sobre Parallels en mi mac. Por tanto voy a instalar ubuntu en su arquitectura arm64.

Vosotros podeis usar otros entornos, ubuntu directamente en vuestro laptop, una maquina virtual en vuestro ordenador usando virtual box o vmware, etc.

Lo que es importante es que tengan ubuntu instalado y que puedan ejecutar comandos. 

## Instalacion de docker 

Todo lo que vais a ver a continuacion esta en 

https://docs.docker.com/engine/install/ubuntu/

### Paso 1: Desinstalar versiones antiguas de Docker (si existen)

Si tienes una versión anterior de Docker instalada, necesitas desinstalarla primero:

```bash
sudo apt-get remove docker docker-engine docker.io containerd runc
```

### Paso 2: Actualizar el sistema e instalar dependencias

Primero, actualiza el índice de paquetes e instala las dependencias necesarias:

```bash
sudo apt-get update

sudo apt-get install -y \
    ca-certificates \
    curl \
    gnupg \
    lsb-release
```

### Paso 3: Añadir el repositorio oficial de Docker

#### 3.1 Crear el directorio para las claves GPG

```bash
sudo mkdir -m 0755 -p /etc/apt/keyrings
```

#### 3.2 Descargar la clave GPG de Docker

```bash
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
```

#### 3.3 Configurar los permisos de la clave

```bash
sudo chmod a+r /etc/apt/keyrings/docker.gpg
```

#### 3.4 Añadir el repositorio a las fuentes de apt

```bash
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
```

### Paso 4: Instalar Docker Engine

Actualiza el índice de paquetes e instala Docker Engine:

```bash
sudo apt-get update

sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
```

### Paso 5: Configurar permisos para usuario no-root (opcional pero recomendado)

Para ejecutar Docker sin usar `sudo`, añade tu usuario al grupo `docker`:

```bash
# Crear el grupo docker (probablemente ya existe)
sudo groupadd docker

# Añadir tu usuario al grupo
sudo usermod -aG docker $USER

# Activar los cambios en el grupo
newgrp docker
```

### Paso 6: Verificar la instalación

Verifica que Docker se instaló correctamente ejecutando:

```bash
docker --version
```

Deberías ver algo como:
```
Docker version 27.0.0, build xxxx
```

Además, ejecuta el contenedor de prueba:

```bash
docker run hello-world
```

Si todo va bien, verás un mensaje de bienvenida indicando que la instalación fue exitosa.

### Paso 7: Habilitar Docker para que inicie con el sistema (opcional)

```bash
sudo systemctl enable docker
sudo systemctl start docker
```

Verifica que Docker está ejecutándose:

```bash
sudo systemctl status docker
```

---

## Solución de problemas

### Error de permisos al ejecutar docker

Si aún necesitas usar `sudo` después de añadir tu usuario al grupo `docker`, intenta cerrar sesión y volver a iniciarla, o reinicia tu máquina.

### Error de conexión al descargar la clave GPG

Asegúrate de tener conexión a internet y que no hay un firewall bloqueando el acceso a `download.docker.com`.

### Docker no inicia

Verifica los logs con:
```bash
sudo journalctl -u docker -n 50
```

---

## Próximos pasos

Una vez que tengas Docker instalado y funcionando, estaremos listos para:
- Ejecutar contenedores
- Crear imágenes personalizadas
- Entender la arquitectura de Docker
